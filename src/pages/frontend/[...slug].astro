---
import { getCollection, render } from "astro:content";
import HandbookLayout from "../../layouts/HandbookLayout.astro";

export async function getStaticPaths() {
  const allChapters = await getCollection("docs", ({ data, id }) => {
    return id.startsWith("frontend/") && !data.draft;
  });

  return allChapters.map((chapter) => ({
    params: { slug: chapter.id.replace("frontend/", "").replace(/\.mdx?$/, "") },
    props: { chapter },
  }));
}

const { chapter } = Astro.props;
const { Content } = await render(chapter);

// Get all chapters for the sidebar/nav
const allChapters = await getCollection("docs", ({ data, id }) => {
  return id.startsWith("frontend/") && !data.draft;
});

// Sort chapters by order
const chapters = allChapters
  .sort((a, b) => a.data.sidebar.order - b.data.sidebar.order)
  .map((ch) => ({
    ...ch,
    slug: ch.id.replace("frontend/", "").replace(/\.mdx?$/, ""),
  }));

const currentSlug = chapter.id.replace("frontend/", "").replace(/\.mdx?$/, "");
---

<HandbookLayout
  pageTitle={`Frontend Handbook: ${chapter.data.title}`}
  chapters={chapters}
  currentSlug={currentSlug}
>
  <h1>{chapter.data.title}</h1>
  <Content />
</HandbookLayout>
